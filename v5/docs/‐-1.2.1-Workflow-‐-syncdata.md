<TABLE width="100%"><TR><TD align="left"><a href="‐-1.2.0-Workflows.md">PREV < 1.2.0 Workflows</a></TD><TD align="right"><a href="‐-1.2.2-Workflow-‐-archivedata.md">1.2.2 Workflow - archivedata > NEXT</a></TD></TR></TABLE>

[ELI5 - Workflow - syncdata](‐-1.2.1.1-Workflow-‐-syncdata-‐-eli5.md)

Workflow Documentation: Data Workflow

Workflow Name:

Data Workflow

Filename:

dataworkflow.yml


---

Purpose

The "Data Workflow" is a comprehensive automation process designed to handle updates, validation, and archival for the data.json file. It is triggered by pushes to the repository or manually via workflow_dispatch. This workflow integrates validation, templating, version archiving, and cleanup tasks, ensuring efficient and reliable file management.


---

Key Components

1. Triggers

Triggered by pushes to updates/data.json.

Can also be triggered manually using workflow_dispatch.



2. Environment Variables

DRYRUN: Enables or disables test mode.

CLEANUP_PERIOD: Specifies how often old files are purged.



3. Permissions

Grants write access to repository contents and issues for notifications.



4. Jobs and Steps



Job: data_workflow

Runs on ubuntu-latest and includes the following steps:


---

Step-by-Step Breakdown

Step 1: Checkout Repository

Ensures the workflow has access to the latest repository contents using actions/checkout@v3. Fetch depth is set to 0 for full history.

Step 2: Set up Git Configuration

Configures Git user credentials and sets the repository remote URL for pushing changes.

Step 3: Validate JSON File

Runs a Python script (scripts/validate_json.py) to ensure the data.json file adheres to required formatting. Exits the workflow on failure.

Step 4: Apply Template

Executes scripts/apply_template.py to apply standardized templates. Logs errors if the script fails.

Step 5: Copy and Archive Data

Copies updates/data.json to the root directory.

Archives the file with a timestamped name in the archive/ directory.


Step 6: Commit and Push Changes

Stages and commits updates to data.json and the archive/.

Pushes changes to the remote repository unless in DRYRUN mode.


Step 7: Debug Archive State

Lists the contents of the archive/ directory to confirm successful archival.

Step 8: Cleanup, Remove Updates, and Clean Changes

Deletes updates/data.json.

Executes scripts/cleanup_purge.py to remove outdated archive files.

Stages and commits changes, ensuring a clean repository state.


Step 9: Notify via GitHub Issues

Uses peter-evans/create-issue-from-file to create an issue with workflow results and log details.

Step 10: Generate Notification Log

Ensures a log file (notification-log.txt) is generated with final workflow details.

Step 11: Debug Workflow State

Outputs the Git repository’s current state and .gitignore contents for debugging purposes.


---

Usage Notes

Ensure the repository has the required scripts (validate_json.py, apply_template.py, cleanup_purge.py) in the scripts/ directory.

Configure secrets.MYSHELF with a valid access token for GitHub API operations.

Validate that vars.DRYRUN and vars.CLEANUP_PERIOD are set as required.



---

Key Benefits

Automated file validation and templating.

Seamless versioning with timestamped archives.

Robust error handling and GitHub issue notifications.

Efficient cleanup of outdated files.



<TABLE width="100%"><TR><TD align="left"><a href="‐-1.2.0-Workflows.md">PREV < 1.2.0 Workflows</a></TD><TD align="right"><a href="‐-1.2.2-Workflow-‐-archivedata.md">1.2.2 Workflow - archivedata > NEXT</a></TD></TR></TABLE>
